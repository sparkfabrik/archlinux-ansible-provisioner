---
- name: Install sway
  tags: [wm, sway]
  when: desktop.sway.enable == true
  block:
    - name: Ensure deprecated packages are not present.
      community.general.pacman:
        name:
          - dunst
          - wofi
        state: absent

    - name: Install sway wm
      community.general.pacman:
        name:
          - gdm
          - polkit-gnome
          - sway
          - swaybg
          - swayidle
          - swaylock

    - name: System utilities
      community.general.pacman:
        name:
          - alacritty
          - ghostty
          - thunar
          - rofi
          - wl-clipboard
          - ranger

    - name: Display server gui
      kewlfft.aur.aur:
        use: paru
        name:
          - wdisplays
      become: true
      become_user: aur_builder

    - name: Clipboard manager
      kewlfft.aur.aur:
        use: paru
        name:
          - clipman
      become: true
      become_user: aur_builder

    - name: Network utilities
      community.general.pacman:
        name:
          - network-manager-applet
          - blueman

    - name: Notification system
      community.general.pacman:
        name:
          - mako

    - name: Install sway contrib (grim and other utilities)
      kewlfft.aur.aur:
        name:
          - sway-contrib
      become: true
      become_user: aur_builder

    - name: Install fonts from aur
      kewlfft.aur.aur:
        use: paru
        name:
          - ttf-meslo-nerd-font-powerlevel10k
      become: true
      become_user: aur_builder

    - name: Multimedia controls
      kewlfft.aur.aur:
        name:
          - gammastep
          - light
          - swayosd
      become: true
      become_user: aur_builder

    - name: Enable swayosd-libinput-backend service
      shell: systemctl enable swayosd-libinput-backend.service

    - name: Screensharing
      community.general.pacman:
        name:
          - xdg-desktop-portal-wlr
          - xdg-desktop-portal

    - name: Waybar
      when: desktop.sway.waybar == true
      community.general.pacman:
        name:
          - waybar
          - otf-font-awesome
          - woff2-font-awesome

    - name: Configure login launcher due to this issue - https://github.com/swaywm/sway/issues/3109
      ansible.builtin.copy:
        src: sway-shell.desktop
        dest: /usr/share/wayland-sessions/sway-shell.desktop

    - name: Install the openrgb flatpak
      flatpak:
        name: org.openrgb.OpenRGB
        state: present
